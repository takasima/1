<__trans_section component="PowerRevision">
<$mt:setvar name="page_title" value="<__trans phrase="Manage Revision">"$>

<mt:setvarblock name="system_msg">
    <div id="msg-container">
    <mt:if name="saved_deleted">
        <mtapp:statusmsg
            id="saved-deleted"
            class="success">
                <__trans phrase="The revision data has been deleted from the database.">
        </mtapp:statusmsg>
    </mt:if>
    <mt:if name="not_changes">
        <mtapp:statusmsg
            id="saved-deleted"
            class="success">
                <__trans phrase="Your changes to the revision data has not saved.">
                <mt:if name="not_diff"><__trans phrase="Some entry data is equal to revison data."></mt:if>
        </mtapp:statusmsg>
    </mt:if>
    <mt:if name="saved_changes">
        <mt:if name="blog_id">    
            <mt:setvar name="rebuild" value="all">
        <mt:else>
            <mt:setvar name="rebuild" value="">
        </mt:if>
        <mtapp:statusmsg
            id="saved-changes"
            class="success"
            rebuild="$rebuild">
                <__trans phrase="Your changes to the revision data has been saved.">
        </mtapp:statusmsg>
    </mt:if>
    <mt:if name="saved">
        <mtapp:statusmsg
            id="saved"
            class="success">
                 <__trans phrase="Your changes have been saved.">
        </mtapp:statusmsg>
    </mt:if>
    </div>
</mt:setvarblock>

<mt:setvarblock name="related_content">
    <$mtapp:PageActions from="$mode"$>
</mt:setvarblock>

<mt:setvarblock name="html_body_footer">
    <$mt:include name="include/display_options.tmpl"$>
</mt:setvarblock>

<mt:setvarblock name="html_head" append="1">
<script type="text/javascript">
/* <![CDATA[ */
function enableFilterButton () {
    getByID( 'filter-button' ).style.display = 'inline';
}

function toggleFilter () {
    var filterActive = getByID( 'filter-title' );
    if ( filterActive.style.display == 'none' ) {
        filterActive.style.display = 'block';
        getByID ( 'filter-select' ) .style.display = "none";
    } else {
        filterActive.style.display = 'none';
        getByID ( 'filter-select' ) .style.display = "block";
    }
}

function setFilterCol ( choice ) {
    var sel = getByID ( 'filter-select-form' );
    if ( !sel ) return;
    var filters = [ 'object_status', 'object_class', 'class', 'status', 'author_id' ];
    var fld = getByID( 'filter-col' );
    for ( var i = 0; i < filters.length; i++ ) {
        var filter_sel = getByID( 'filter-' + filters[ i ] );
        if ( filter_sel ) {
            if ( choice == filters[ i ] ) {
                filter_sel.style.display = 'inline';
                if ( fld ) {
                    fld.selectedIndex = i;
                }
            } else {
                filter_sel.style.display = 'none';
            }
        }
    }    
    if ( choice == 'none' ) {
        var filter_sel = getByID( 'filter-' + filters[ 0 ] );
        filter_sel.style.display = 'inline';
    }
    col_span = getByID ( 'filter-text-col' );
    if ( choice != 'none' ) {
        if ( fld.selectedIndex > -1 && col_span ) {
            col_span.innerHTML =
                fld.options[fld.selectedIndex].text;
        }
        if ( choice == 'object_id' ) {
            val_span = getByID ( 'filter-text-val' );
            val_span.innerHTML =
                'entry_id:<mt:var name="filter_val" escape="js">';
        }
    }
}

var tableSelect;
function init()
{
    // setup
    tableSelect = new TC.TableSelect( "<$mt:var name="object_type"$>-listing-table" );
    tableSelect.rowSelect = true;
    setFilterCol(<mt:if name="filter">'<mt:var name="filter" escape="js">'<mt:else>'none'</mt:if>);<mt:if name="filter">
    setFilterVal('<mt:var name="filter_val" escape="js">');
</mt:if>
}

TC.attachLoadEvent( init );
/* ]]> */
</script>

</mt:setvarblock>

<mt:setvarblock name="list_filter_form">
<form id="filter-form" method="get" action="<mt:var name="mt_url">">
    <input type="hidden" name="__mode" value="list_<$mt:var name="object_type"$>" />
        <mt:if name="blog_id">
    <input type="hidden" name="blog_id" value="<mt:var name="blog_id">" />
        </mt:if>
    <input id="filter" type="hidden" name="filter" value="" />
    <input id="filter_val" type="hidden" name="filter_val" value="" />
</form>
<div class="listing-filter">
    <div class="listing-filter-inner inner pkg">
        <form id="filter-select-form" method="get" onsubmit="execFilter(this)">
            <div class="filter">
                <div id="filter-title" class="filter-title">
            <mt:unless name="filter">
                    <strong><__trans phrase="All [_1]" params="<$mt:var name="object_label_plural"$>"></strong>
                    <a href="javascript:void(0)" onclick="toggleFilter()" class="filter-link">[ <__trans phrase="change"> ]</a>
            <mt:else>
                <mt:if name="filter" eq="id">
                    <strong>
                        <__trans phrase="[_1] where [_2] is [_3]" params='<$mt:var name="object_label_plural"$>%%ID%%<$mt:var name="filter_val" escape="html"$>'>
                    </strong>
                <mt:else>
                    <mt:if name="filter_key">
                        <strong><__trans phrase="Showing only: [_1]" params="<mt:var name="filter_label">"></strong>
                    <mt:else>
                        <strong>
                            <__trans phrase="[_1] where [_2] is [_3]" params='<$mt:var name="object_label_plural"$>%%<span id="filter-text-col">&nbsp;</span>%%<span id="filter-text-val"></span>'>
                        </strong>
                    <a href="<mt:var name="script_url">?__mode=list&amp;_type=<$mt:var name="object_type"$><mt:if name="blog_id">&amp;blog_id=<mt:var name="blog_id"></mt:if><mt:if name="object_class">&amp;filter=object_class&amp;filter_val=<mt:var name="object_class" escape="html"></mt:if>">[ <__trans phrase="Remove filter"> ]</a>
                    </mt:if>
                    
                </mt:if>
            </mt:unless>
                </div>
        <div id="filter-select" class="page-title" style="display: none">
            <!-- start filter form -->
                <select id="filter-col" name="filter" onchange="setFilterCol(this.options[this.selectedIndex].value);enableFilterButton(this)">
                    <option value="object_status"><__trans phrase="Original"></option>
                    <option value="object_class"><__trans phrase="Type"></option>
                    <option value="class"><__trans phrase="Class"></option>
                    <option value="status"><__trans phrase="Status"></option>
                    <option value="author_id"><__trans phrase="User"></option>
                </select>
                <__trans phrase="is">
                <span id="filter-object_status" style="display: none">
                    <select id="object_status-val" name="filter_val" onchange="enableFilterButton()">
                        <option value="2"><__trans phrase="Exists"></option>
                        <option value="1"><__trans phrase="Removed"></option>
                    </select>
                </span>
                <span id="filter-object_class" style="display: none">
                    <select id="object_class-val" name="filter_val" onchange="enableFilterButton()">
                        <option value="entry"><__trans phrase="Entry"></option>
                        <option value="page"><__trans phrase="Page"></option>
                    </select>
                </span>
                <span id="filter-class" style="display: none">
                    <select id="class-val" name="filter_val" onchange="enableFilterButton()">
                        <option value="workflow"><__trans phrase="Workflow"></option>
                        <option value="backup"><__trans phrase="Backup"></option>
                    </select>
                </span>
                <span id="filter-status" style="display: none">
                    <select id="status-val" name="filter_val" onchange="enableFilterButton()">
                        <option value="1"><__trans phrase="Unpublished (Draft)"></option>
                        <option value="4"><__trans phrase="Scheduled"></option>
                        <option value="6"><__trans phrase="Unpublished (Review)"></option>
                    </select>
                </span>
                <span id="filter-author_id" style="display: none">
                    <select id="author_id-val" name="filter_val" onchange="enableFilterButton()">
                        <mt:loop name="author_loop">
                        <option value="<mt:var name="author_id">"><mt:var name="author_name"></option>
                        </mt:loop>
                    </select>
                </span>
            <span class="buttons">
                <button
                    id="filter-button"
                    onclick="return execFilter(getByID('filter-select-form'))"
                    type="submit"
                    ><__trans phrase="Filter"></button>
                <button
                    onclick="toggleFilter(); return false;"
                    type="submit"
                    ><__trans phrase="Cancel"></button>
            </span>
            </div>
        </div>
        </form>
    </div>
</div>
</mt:setvarblock>

<mt:if name="dialog">
<$mt:include name="dialog/header.tmpl" id="header_include"$>
<$mt:var name="list_filter_form"$>
<$mt:include name="dialog/powerrevision_table.tmpl"$>
<$mt:include name="dialog/footer.tmpl"$>
<mt:else>
<$mt:include name="include/header.tmpl" id="header_include"$>
<$mt:var name="list_filter_form"$>
<$mt:include name="include/powerrevision_table.tmpl"$>
<$mt:include name="include/footer.tmpl"$>
</mt:if>
</__trans_section>