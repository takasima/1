name: Members
id: Members
key: members
version: 1.6
schema_version: 0.25
description: <__trans phrase='Enable members area.'>
author_name: Alfasado Inc.
author_link: 'http://alfasado.net/'
l10n_class: Members::L10N
config_settings:
    MemberScript:
        default: mt-members.cgi
    MembersCleanupUserpicPeriod:
        default: 43200
system_config_template: members_sysconfig.tmpl
blog_config_template: members_config.tmpl
settings:
    members_path_base:
        default:
    members_session_timeout:
        default: 3600
    members_signup_timeout:
        default: 604800
    members_registration_status:
        default: 3
    members_email_notify2_active:
        default: 1
    members_email_notify2:
        default:
    members_email_from:
        default:
    members_registration_all:
        default: 0
    validate_username_and_password:
        default: 0
        scope: blog
    username_deny_multibytes:
        default: 1
        scope: blog
    username_allow_alphabet:
        default: 1
        scope: blog
    username_allow_number:
        default: 1
        scope: blog
    username_allow_special_characters:
        default: 1
        scope: blog
    username_minimum_length:
        default: 6
        scope: blog
    password_deny_multibytes:
        default: 1
        scope: blog
    password_combo_upper_lower:
        default: 0
        scope: blog
    password_combo_letter_number:
        default: 0
        scope: blog
    password_require_special_characters:
        default: 0
        scope: blog
    password_minimum_length:
        default: 6
        scope: blog
object_types:
    template:
        subject: text revisioned
    blog:
        is_members: boolean
    author:
        mobile_id: string meta
        mobile_address: string meta
        mail_token: string meta
        regist_blog_id: integer meta
        is_mobile_signup: integer meta
callbacks:
    MT::App::Upgrader::post_run: $Members::Members::Callbacks::_post_run
    MT::App::CMS::template_param.cfg_prefs:        $Members::Members::Callbacks::_cfg_prefs_param
    MT::App::CMS::Members::template_source.login:  $Members::Members::Callbacks::_cb_tmpl_source
    MT::App::CMS::Members::template_source.signup: $Members::Members::Callbacks::_cb_tmpl_source
    cms_pre_load_filtered_list.author: $Members::Members::Callbacks::filtered_list_author
    cms_post_save.blog:   $Members::Members::Callbacks::_do_plugin_setting
    cms_post_save.author: $Members::Members::Callbacks::_notify_registered
    search_blog_list:     $Members::Members::Callbacks::_pre_search
    mail_filter:          $Members::Members::Callbacks::_recover_mail_filter
    build_file_filter:    $Members::Members::Callbacks::_cb_build_file_filter
    MT::App::ContactForm::pre_redirect:  $Members::Members::Callbacks::_contactform_pre_redirect
    api_save_filter.comment: $Members::Members::Callbacks::_cb_api_save_filter_comment
    MT::App::Comments::init_request: >
        sub {
            my $app = MT->instance();
            my $blog = $app->blog;
            if ( $blog && $blog->is_members ) {
                $app->{ requires_login } = 1;
                if ( PowerCMS::Util::is_ua_keitai() ) {
                    if ( my $sessid = $app->param( 'sessid' ) ) {
                        require MT::App::CMS::Members;
                        my $user = MT::App::CMS::Members::_get_author( $app, $sessid );
                        if ( $user ) {
                            $app->user( $user );
                            my %param = (
                                -name  => $app->user_cookie,
                                -value => $user->name . '::' . $sessid . '::0',
                                -path  => '/',
                            );
                            my $cookie = CGI::Cookie->new(%param);
                            $app->{ cookies } = {
                                $app->user_cookie => $cookie,
                            };
                        }
                    }
                }
            }
        }
    MT::App::Comments::template_source.login: $Members::Members::Callbacks::_cb_tmpl_source
permissions:
    blog.view:
        label: View Site
        group: blog_comment
        order: 100
tasks:
    members_cleanup_userpic:
        key: MembersCleanupUserpic
        label: Clean up temporary userpic
        frequency: 3600
        code: $Members::Members::Callbacks::_tasks_members_cleanup_userpic
tags:
    block:
        IfMemberLogin?: $Members::Members::Tags::_hdlr_if_member_login
    function:
        MembersScript:     $Members::Members::Tags::_hdlr_members_script
        MembersLoginCheck: $Members::Members::Tags::_hdlr_members_login_check
        AuthorMobileEmail: $Members::Members::Tags::_hdlr_author_mobile_email
        AuthorMobileToken: $Members::Members::Tags::_hdlr_author_mobile_token
        CustomFieldQuery:  $Members::Members::Tags::_hdlr_field_query
    modifier:
        add_session_for_mobile:   $Members::Members::Tags::_fltr_add_session_for_mobile
        external_link_for_mobile: $Members::Members::Tags::_hdlr_modifier
system_filters:
    author: $Members::Members::Listing::system_filters
applications:
    members:
        handler: MT::App::CMS::Members
        script: sub { MT->config->MemberScript }
