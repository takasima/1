id: TemplateSelector
key: templateselector
name: TemplateSelector
description: <__trans phrase="Select Template by each Entry.">
author_name: Alfasado Inc.
author_link: http://alfasado.net/
version: 3.7
schema_version: 0.21
l10n_class: TemplateSelector::L10N
blog_config_template: templateselector_config_blog.tmpl
settings:
    entry_sort_by:
        default: created_on
    entry_sort_order:
        default: descend
    page_sort_by:
        default: created_on
    page_sort_order:
        default: descend

object_types:
    entry:
        template_module_id: integer
        prefs: text
    template:
        is_selector: integer
        is_default_selector: integer
        thumbnail_path: string(255)
        default_entry_id: integer
        object_class: string(255)
applications:
    cms:
        menus:
            entry:select_entry_tmpl:
                label: Entry from Template
                mode: select_entry_tmpl
                order: 201
                permission: create_post
                view: blog
                dialog: 1
            page:select_page_tmpl:
                label: Page from Template
                mode: select_page_tmpl
                order: 201
                permission: manage_pages
                view:
                    - blog
                    - website
                dialog: 1
            design:entry_templates:
                label: "&nbsp;&nbsp;Entry templates"
                mode: list
                args:
                    _type: entry
                    filter_key: _template
                order: 600
                permission: edit_templates
                view: blog
            design:page_templates:
                label: "&nbsp;&nbsp;Page templates"
                mode: list
                args:
                    _type: page
                    filter_key: _template
                order: 700
                permission: edit_templates
                view:
                    - blog
                    - website
        content_actions:
            entry:
                create_entry_template:
                    class: icon-create
                    label: Create new entry template
                    mode: view
                    args:
                        _type: entry
                        is_create_template: 1
                    condition: >
                        sub {
                            my $app = MT->instance();
                            my $class = $app->param( '_type' );
                            if ( $class && $class eq 'entry' ) {
                                my $filter_key = $app->param( 'filter_key' );
                                if ( $filter_key && $filter_key eq '_template' ) {
                                    require TemplateSelector::Util;
                                    return TemplateSelector::Util::can_create_template_selector();
                                }
                            }
                            return 0;
                        }
            page:
                create_page_template:
                    class: icon-create
                    label: Create new page template
                    mode: view
                    args:
                        _type: page
                        is_create_template: 1
                    condition: >
                        sub {
                            my $app = MT->instance();
                            my $class = $app->param( '_type' );
                            if ( $class && $class eq 'page' ) {
                                my $filter_key = $app->param( 'filter_key' );
                                if ( $filter_key && $filter_key eq '_template' ) {
                                    require TemplateSelector::Util;
                                    return TemplateSelector::Util::can_create_template_selector();
                                }
                            }
                            return 0;
                        }
system_filters:
    entry:
        _template:
            label: Entry templates
            order: 100
    page:
        _template:
            label: Page templates
            order: 100
methods:
    select_entry_tmpl: $templateselector::TemplateSelector::Plugin::select_entry_tmpl
    select_page_tmpl: $templateselector::TemplateSelector::Plugin::select_page_tmpl
callbacks:
    MT::App::CMS::template_source.edit_entry:
        - handler: $templateselector::TemplateSelector::Plugin::_cb_ts_edit_entry
    MT::App::CMS::template_param.edit_entry:
        - handler: $templateselector::TemplateSelector::Plugin::_cb_tp_edit_entry
        - handler: $templateselector::TemplateSelector::Plugin::_cb_tp_edit_entry_extra_status
        - handler: $templateselector::TemplateSelector::Plugin::_cb_tp_edit_entry_entry_prefs
          priority: 10
    MT::App::CMS::template_param.edit_template: $templateselector::TemplateSelector::Plugin::_cb_tp_edit_template
    cms_post_save.entry:
        - handler: $templateselector::TemplateSelector::Plugin::_cb_cms_post_save_entry_save_prefs
        - handler: $templateselector::TemplateSelector::Plugin::_cb_cms_post_save_entry
    cms_post_save.page:
        - handler: $templateselector::TemplateSelector::Plugin::_cb_cms_post_save_entry_save_prefs
        - handler: $templateselector::TemplateSelector::Plugin::_cb_cms_post_save_entry
    MT::App::CMS::template_param.preview_strip: $templateselector::TemplateSelector::Plugin::_cb_tp_preview_strip
    MT::App::CMS::template_source.edit_template: $templateselector::TemplateSelector::Plugin::_cb_ts_edit_template
    cms_post_save.template: $templateselector::TemplateSelector::Plugin::_cb_cms_post_save_template
    cms_post_delete.template: $templateselector::TemplateSelector::Plugin::_cb_cms_post_delete_template
    MT::App::CMS::template_source.list_entry: $templateselector::TemplateSelector::Plugin::_cb_ts_list_entry
    MT::App::CMS::template_param.list_entry: $templateselector::TemplateSelector::Plugin::_cb_tp_list_entry
    MT::App::CMS::template_param.blog_stats: $templateselector::TemplateSelector::Plugin::_cb_tp_blog_stats
    cms_pre_load_filtered_list.entry: $templateselector::TemplateSelector::Plugin::_cb_cms_pre_load_filtered_list_entry
    cms_pre_load_filtered_list.page: $templateselector::TemplateSelector::Plugin::_cb_cms_pre_load_filtered_list_entry
    MT::App::CMS::template_param.list_common: $templateselector::TemplateSelector::Plugin::_cb_tp_list_common
    MT::Blog::post_clone: $templateselector::TemplateSelector::Plugin::_cb_post_clone
    cms_post_save.field: $templateselector::TemplateSelector::Plugin::_cb_cms_post_save_field
    MT::App::CMS::template_param.edit_field: $templateselector::TemplateSelector::Plugin::_cb_tp_edit_field
    MT::App::CMS::template_output.edit_field: $templateselector::TemplateSelector::Plugin::_cb_to_edit_field
    restore: $templateselector::TemplateSelector::Plugin::_cb_restore
    MT::Permission::post_save: $templateselector::TemplateSelector::Plugin::_cb_permission_post_save
tags:
    block:
        IfTemplateSelector?: $templateselector::TemplateSelector::Tags::_hdlr_template_selector
        TemplateSelector?: $templateselector::TemplateSelector::Tags::_hdlr_template_selector
        IfTemplateSelectorBlock?: $templateselector::TemplateSelector::Tags::_hdlr_template_selector_block
    function:
        EntryTemplateName: $templateselector::TemplateSelector::Tags::_hdlr_entry_template_name
